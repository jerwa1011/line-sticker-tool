<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sticker Studio Air</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&family=Noto+Serif+TC:wght@400;700&family=Zen+Maru+Gothic:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-color: #e5e5e5;
            --panel-bg: rgba(255, 255, 255, 0.75);
            --accent-color: #007AFF;
            --text-color: #333;
        }

        body {
            margin: 0;
            overflow: hidden; /* ç¦æ­¢ç€è¦½å™¨é è¨­æ²å‹• */
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            background-image: radial-gradient(#ccc 1px, transparent 1px);
            background-size: 20px 20px; /* ç¶²æ ¼èƒŒæ™¯ */
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* UI é¢æ¿ (macOS Glassmorphism) */
        .ui-panel {
            position: absolute;
            background: var(--panel-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border-radius: 12px;
            padding: 10px;
            z-index: 100;
        }

        /* é ‚éƒ¨å·¥å…·åˆ— */
        .toolbar {
            top: 20px;
            display: flex;
            gap: 15px;
            align-items: center;
        }

        /* è¦–çª—å®¹å™¨ (Viewport) */
        #viewport {
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            cursor: default; /* é è¨­æ¸¸æ¨™ */
        }
        
        /* æŠ“æ‰‹æ¨¡å¼æ¸¸æ¨™ */
        #viewport.panning {
            cursor: grab;
        }
        #viewport.panning:active {
            cursor: grabbing;
        }

        /* å¯¦éš›ç•«å¸ƒå®¹å™¨ (World) - ç”¨ä¾†è¢«ç¸®æ”¾å’Œå¹³ç§» */
        #world {
            width: 0;
            height: 0;
            position: absolute;
            top: 50%;
            left: 50%;
            transform-origin: 0 0; /* è®Šå½¢åŸé» */
        }

        /* æ¨¡æ“¬çš„ LINE è²¼åœ–ç•«å¸ƒ */
        .canvas-area {
            width: 370px;
            height: 320px;
            background: white;
            box-shadow: 0 20px 50px rgba(0,0,0,0.15);
            position: absolute;
            top: -160px; /* Center alignment based on size */
            left: -185px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #aaa;
            font-size: 14px;
            user-select: none;
            overflow: hidden; /* ç¢ºä¿å…§å®¹ä¸è·‘å‡ºå» */
        }
        
        /* æ¸¬è©¦æ–‡å­— */
        .sticker-text {
            position: absolute;
            font-size: 40px;
            font-weight: bold;
            color: #333;
            cursor: move;
            border: 1px dashed transparent;
        }
        .sticker-text:hover {
            border: 1px dashed var(--accent-color);
        }

        button {
            background: rgba(255,255,255,0.8);
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 13px;
            cursor: pointer;
            transition: 0.2s;
        }
        button:hover {
            background: white;
            color: var(--accent-color);
        }

        /* å­—å‹é¸å–® */
        select {
            padding: 6px;
            border-radius: 6px;
            border: 1px solid #ddd;
            font-size: 13px;
            background: transparent;
        }
        
        /* æç¤ºæ–‡å­— */
        .hint {
            position: absolute;
            bottom: 20px;
            left: 20px;
            font-size: 12px;
            color: #666;
            background: rgba(255,255,255,0.6);
            padding: 5px 10px;
            border-radius: 20px;
            pointer-events: none;
        }
    </style>
</head>
<body>

    <div class="ui-panel toolbar">
        <span style="font-weight:600; font-size:14px;">Sticker Studio Air</span>
        <div style="width: 1px; height: 15px; background: #ccc;"></div>
        
        <select id="fontSelector" onchange="changeFont(this.value)">
            <option value="'Noto Sans TC', sans-serif">æ€æºé»‘é«” (é è¨­)</option>
            <option value="'Zen Maru Gothic', sans-serif">åœ“é«” (å¯æ„›)</option>
            <option value="'Noto Serif TC', serif">æ€æºå®‹é«” (æ–‡é’)</option>
            <option value="Arial, sans-serif">Arial (è‹±æ–‡)</option>
            <option value="Impact, sans-serif">Impact (è¿·å› )</option>
        </select>

        <button onclick="resetView()">é‡ç½®è¦–è§’</button>
        <button style="color: var(--accent-color);">åŒ¯å‡º PNG</button>
    </div>

    <div id="viewport">
        <div id="world">
            <div class="canvas-area" id="canvasArea">
                <div class="sticker-text" id="demoText" style="top: 100px; left: 80px;">å“ˆå›‰ä½ å¥½!</div>
                </div>
        </div>
    </div>
    
    <div class="hint">ğŸ’¡ æç¤ºï¼šæ»¾è¼ªç¸®æ”¾ â€¢ æŒ‰ä½ç©ºç™½éµ + æ‹–æ›³ç§»å‹•ç•«å¸ƒ</div>

    <script>
        // è®Šæ•¸è¨­å®š
        const viewport = document.getElementById('viewport');
        const world = document.getElementById('world');
        
        let scale = 1;
        let pannedX = 0;
        let pannedY = 0;
        
        let isSpaceDown = false;
        let isDragging = false;
        let startX, startY;

        // 1. è™•ç†æ»¾è¼ªç¸®æ”¾ (Zoom)
        viewport.addEventListener('wheel', (e) => {
            e.preventDefault();
            
            const zoomIntensity = 0.1;
            const delta = e.deltaY > 0 ? -zoomIntensity : zoomIntensity;
            const newScale = Math.min(Math.max(0.1, scale + delta), 5); // é™åˆ¶ç¸®æ”¾ 0.1x ~ 5x

            // ç°¡å–®çš„ä¸­å¿ƒç¸®æ”¾ (é€²éšç‰ˆå¯ä»¥åšæ¸¸æ¨™æŒ‡å‘ç¸®æ”¾)
            scale = newScale;
            updateTransform();
        }, { passive: false });

        // 2. è™•ç†å¹³ç§» (Pan) - åµæ¸¬ç©ºç™½éµ
        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space') {
                isSpaceDown = true;
                viewport.classList.add('panning');
            }
        });

        document.addEventListener('keyup', (e) => {
            if (e.code === 'Space') {
                isSpaceDown = false;
                viewport.classList.remove('panning');
                isDragging = false; // ç¢ºä¿æ”¾é–‹ç©ºç™½éµæ™‚åœæ­¢æ‹–æ›³
            }
        });

        // 3. æ»‘é¼ æ‹–æ›³é‚è¼¯
        viewport.addEventListener('mousedown', (e) => {
            // åªæœ‰æŒ‰ä½ç©ºç™½éµæ™‚ï¼Œå·¦éµæ‰èƒ½æ‹–å‹•è¦–çª—
            if (isSpaceDown) {
                isDragging = true;
                startX = e.clientX - pannedX;
                startY = e.clientY - pannedY;
            }
        });

        viewport.addEventListener('mousemove', (e) => {
            if (isDragging && isSpaceDown) {
                e.preventDefault();
                pannedX = e.clientX - startX;
                pannedY = e.clientY - startY;
                updateTransform();
            }
        });

        viewport.addEventListener('mouseup', () => {
            isDragging = false;
        });
        
        viewport.addEventListener('mouseleave', () => {
            isDragging = false;
        });

        // æ›´æ–° CSS Transform
        function updateTransform() {
            // ä½¿ç”¨ translate å’Œ scale ä¾†æ§åˆ¶
            world.style.transform = `translate(${pannedX}px, ${pannedY}px) scale(${scale})`;
        }

        // é‡ç½®åŠŸèƒ½
        function resetView() {
            scale = 1;
            pannedX = 0;
            pannedY = 0;
            updateTransform();
        }

        // 4. å­—å‹åˆ‡æ›åŠŸèƒ½
        function changeFont(fontFamily) {
            const textElement = document.getElementById('demoText');
            textElement.style.fontFamily = fontFamily;
        }
        
        // åˆå§‹åŒ–å­—å‹
        changeFont("'Noto Sans TC', sans-serif");
        
        // ç°¡å–®çš„æ–‡å­—æ‹–æ›³ (æ¨¡æ“¬è²¼åœ–ç·¨è¼¯)
        const demoText = document.getElementById('demoText');
        let isTextDragging = false;
        let textOffsetX, textOffsetY;

        demoText.addEventListener('mousedown', (e) => {
            if (isSpaceDown) return; // å¦‚æœæ­£åœ¨å¹³ç§»ç•«å¸ƒï¼Œä¸è¦è§¸ç™¼æ–‡å­—æ‹–æ›³
            e.stopPropagation(); // é˜²æ­¢å†’æ³¡
            isTextDragging = true;
            textOffsetX = e.clientX - demoText.offsetLeft * scale; // ç°¡åŒ–è¨ˆç®—
            textOffsetY = e.clientY - demoText.offsetTop * scale;
            demoText.style.cursor = 'grabbing';
        });
        
        // æ³¨æ„ï¼šé€™è£¡åªæ˜¯ç°¡å–®æ¼”ç¤º DOM æ‹–æ›³ï¼Œæ­£å¼ç‰ˆæˆ‘å€‘æœƒç”¨ Canvas å…§éƒ¨é‚è¼¯è™•ç†
        window.addEventListener('mouseup', () => {
            isTextDragging = false;
            demoText.style.cursor = 'move';
        });
    </script>
</body>
</html>
